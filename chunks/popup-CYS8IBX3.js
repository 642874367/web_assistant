import{d as C,r as o,c as d,o as v,t as h,s as p,_ as L,a as U,b as g,R as N,e as a,f as y,g as O,F as T,w as b,v as k,h as A,i as D}from"./_plugin-vue_export-helper-BTBGcpDH.js";const M=["disabled"],j=C({__name:"LogoutButton",emits:["logout-success","logout-error"],setup(S,{emit:n}){const l=n,u=o(!1),c=async()=>{try{u.value=!0,await Promise.all([p.removeItem("local:token"),p.removeItem("local:username")]),l("logout-success")}catch(r){console.error("登出失败:",r),l("logout-error","登出失败，请重试")}finally{u.value=!1}};return(r,s)=>(v(),d("button",{class:"logout-button",disabled:u.value,onClick:c},h(u.value?"登出中...":"登出"),9,M))}}),F=L(j,[["__scopeId","data-v-90a38490"]]),W={class:"container"},q={key:0,class:"unsupported-site-notice"},J={key:1,class:"logged-in-container"},z={class:"logged-in-info"},G={class:"username"},H={class:"input-group"},K={class:"input-wrapper"},Q={class:"input-group"},X={class:"input-wrapper verify-code-wrapper"},Y=["disabled"],Z={key:0,class:"error-message"},ee=["disabled"],te=C({__name:"App",setup(S){const n=o(""),l=o(""),u=o(!1),c=o(!1),r=o(!1),s=o(""),i=o(0),m=o(""),w=o(!1),_=t=>/^1[3-9]\d{9}$/.test(t),x=t=>/^\d{4,6}$/.test(t),P=async()=>{if(!_(n.value)){s.value="请输入11位数字的手机号";return}try{c.value=!0,s.value="",await A.sendSms(n.value),i.value=60;const t=setInterval(()=>{i.value--,i.value<=0&&clearInterval(t)},1e3)}catch(t){s.value=`发送失败: ${t.message}`}finally{c.value=!1}},V=async()=>{if(!_(n.value)){s.value="请输入11位数字的手机号";return}if(!x(l.value)){s.value="请输入4-6位数字验证码";return}try{r.value=!0,s.value="";const e=await(await fetch("https://www.businessconnectchina.com/api/v1/resume/smsVerify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:n.value,code:l.value})})).json();if(e.status===0)await p.setItem("local:token",e.data.token),await p.setItem("local:username",e.data.username),m.value=e.data.username,w.value=!0,s.value="登录成功";else throw new Error(e.message)}catch(t){s.value=`登录失败: ${t.message}`}finally{r.value=!1}},E=()=>{w.value=!1,m.value="",n.value="",l.value="",s.value="",i.value=0,c.value=!1,r.value=!1},R=t=>{s.value=t},$=async()=>{const t=await p.getItem("local:token"),e=await p.getItem("local:username");t&&e&&(m.value=e,w.value=!0)},B=async()=>{try{await g.sidePanel.setOptions({enabled:!0,path:"sidepanel.html"}),await g.sidePanel.open({windowId:(await g.windows.getCurrent()).id})}catch(t){console.error("Error toggling sidepanel:",t)}};return U(async()=>{await $();try{const[t]=await g.tabs.query({active:!0,currentWindow:!0}),e=new URL(t.url||"").hostname,f=N.getInstance();u.value=!f.checkSupportedDomain(e)}catch(t){console.error("检查网站支持状态失败:",t)}}),(t,e)=>(v(),d("div",W,[e[5]||(e[5]=a("h2",null,"Web助手登录",-1)),u.value?(v(),d("div",q," 当前网站暂不支持简历解析 ")):y("",!0),w.value?(v(),d("div",J,[a("div",z,[e[2]||(e[2]=a("span",{class:"user-icon"},"👤",-1)),a("span",G,h(m.value),1)]),O(F,{username:m.value,onLogoutSuccess:E,onLogoutError:R},null,8,["username"])])):(v(),d(T,{key:2},[a("div",H,[e[3]||(e[3]=a("label",{for:"phone"},"手机号",-1)),a("div",K,[b(a("input",{id:"phone","onUpdate:modelValue":e[0]||(e[0]=f=>n.value=f),type:"tel",maxlength:"11",placeholder:"请输入手机号"},null,512),[[k,n.value]])])]),a("div",Q,[e[4]||(e[4]=a("label",{for:"verifyCode"},"验证码",-1)),a("div",X,[b(a("input",{id:"verifyCode","onUpdate:modelValue":e[1]||(e[1]=f=>l.value=f),type:"text",maxlength:"6",placeholder:"请输入验证码"},null,512),[[k,l.value]]),a("button",{class:"verify-code-button",disabled:i.value>0||c.value,onClick:P},h(i.value>0?`${i.value}s后重试`:"获取验证码"),9,Y)])]),s.value?(v(),d("div",Z,h(s.value),1)):y("",!0),a("button",{class:"login-button",disabled:r.value,onClick:V},h(r.value?"登录中...":"登录"),9,ee)],64)),a("button",{class:"show-panel-button",onClick:B}," 打开简历面板 ")]))}}),ae=L(te,[["__scopeId","data-v-f6b0e325"]]);D(ae).mount("#app");var I;(I=document.getElementById("toggleSidepanel"))==null||I.addEventListener("click",async()=>{await g.sidePanel.open({windowId:(await g.windows.getCurrent()).id})});
