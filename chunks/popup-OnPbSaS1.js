import{d as L,r,c as g,o as m,t as w,s as u,_ as S,a as U,b as f,R as j,e as s,f as b,u as _,i as p,g as A,h as d,F as D,w as k,v as I,j as F,k as M}from"./AuthState-gwzX-Ifq.js";const T=["disabled"],W=L({__name:"LogoutButton",emits:["logout-success","logout-error"],setup(x,{emit:o}){const n=o,i=r(!1),v=async()=>{try{i.value=!0,await Promise.all([u.removeItem("local:token"),u.removeItem("local:username")]),n("logout-success")}catch(l){console.error("登出失败:",l),n("logout-error","登出失败，请重试")}finally{i.value=!1}};return(l,a)=>(m(),g("button",{class:"logout-button",disabled:i.value,onClick:v},w(i.value?"登出中...":"登出"),9,T))}}),q=S(W,[["__scopeId","data-v-90a38490"]]),J={class:"container"},z={key:0,class:"unsupported-site-notice"},G={key:1,class:"logged-in-container"},H={class:"logged-in-info"},K={class:"username"},Q={class:"input-group"},X={class:"input-wrapper"},Y={class:"input-group"},Z={class:"input-wrapper verify-code-wrapper"},ee=["disabled"],te={key:0,class:"error-message"},ae=["disabled"],se=L({__name:"App",setup(x){const o=r(""),n=r(""),i=r(!1),v=r(!1),l=r(!1),a=r(""),c=r(0),y=t=>/^1[3-9]\d{9}$/.test(t),E=t=>/^\d{4,6}$/.test(t),P=async()=>{if(!y(o.value)){a.value="请输入11位数字的手机号";return}try{v.value=!0,a.value="";const t=await F.sendSms(o.value);t.status===2?a.value="用户名未注册，请先注册":t.status===0?a.value="验证码已发送":a.value=t.message||"发送失败",c.value=60;const e=setInterval(()=>{c.value--,c.value<=0&&clearInterval(e)},1e3)}catch(t){a.value=`注意: ${t.message}`}finally{v.value=!1}},V=async()=>{if(!y(o.value)){a.value="请输入11位数字的手机号";return}if(!E(n.value)){a.value="请输入4-6位数字验证码";return}try{l.value=!0,a.value="";const e=await(await fetch("https://www.businessconnectchina.com/api/v1/resume/smsVerify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:o.value,code:n.value})})).json();if(e.status===0)await u.setItem("local:token",e.data.token),await u.setItem("local:username",e.data.username),d.value=e.data.username,p.value=!0,a.value="登录成功";else throw new Error(e.message)}catch(t){a.value=`登录失败: ${t.message}`}finally{l.value=!1}},R=()=>{p.value=!1,d.value="",o.value="",n.value="",a.value="",c.value=0,v.value=!1,l.value=!1},$=t=>{a.value=t},B=async()=>{const t=await u.getItem("local:token"),e=await u.getItem("local:username");t&&e?(p.value=!0,d.value=e):(p.value=!1,d.value="")},N=()=>{p.value=!1,d.value="",u.removeItem("local:token"),u.removeItem("local:username")},O=async()=>{try{await f.sidePanel.setOptions({enabled:!0,path:"sidepanel.html"}),await f.sidePanel.open({windowId:(await f.windows.getCurrent()).id})}catch(t){console.error("Error toggling sidepanel:",t)}};return U(async()=>{B(),window.addEventListener("force-logout",N);try{const[t]=await f.tabs.query({active:!0,currentWindow:!0}),e=new URL(t.url||"").hostname,h=j.getInstance();i.value=!h.checkSupportedDomain(e)}catch(t){console.error("检查网站支持状态失败:",t)}}),(t,e)=>(m(),g("div",J,[e[5]||(e[5]=s("h2",null,"Web助手登录",-1)),i.value?(m(),g("div",z," 当前网站暂不支持解析 ")):b("",!0),_(p)?(m(),g("div",G,[s("div",H,[e[2]||(e[2]=s("span",{class:"user-icon"},"👤",-1)),s("span",K,w(_(d)),1)]),A(q,{username:_(d),onLogoutSuccess:R,onLogoutError:$},null,8,["username"])])):(m(),g(D,{key:2},[s("div",Q,[e[3]||(e[3]=s("label",{for:"phone"},"手机号",-1)),s("div",X,[k(s("input",{id:"phone","onUpdate:modelValue":e[0]||(e[0]=h=>o.value=h),type:"tel",maxlength:"11",placeholder:"请输入手机号"},null,512),[[I,o.value]])])]),s("div",Y,[e[4]||(e[4]=s("label",{for:"verifyCode"},"验证码",-1)),s("div",Z,[k(s("input",{id:"verifyCode","onUpdate:modelValue":e[1]||(e[1]=h=>n.value=h),type:"text",maxlength:"6",placeholder:"请输入验证码"},null,512),[[I,n.value]]),s("button",{class:"verify-code-button",disabled:c.value>0||v.value,onClick:P},w(c.value>0?`${c.value}s后重试`:"获取验证码"),9,ee)])]),a.value?(m(),g("div",te,w(a.value),1)):b("",!0),s("button",{class:"login-button",disabled:l.value,onClick:V},w(l.value?"登录中...":"登录"),9,ae)],64)),s("button",{class:"show-panel-button",onClick:O}," 打开简历面板 ")]))}}),oe=S(se,[["__scopeId","data-v-3a4ef7b6"]]);M(oe).mount("#app");var C;(C=document.getElementById("toggleSidepanel"))==null||C.addEventListener("click",async()=>{await f.sidePanel.open({windowId:(await f.windows.getCurrent()).id})});
